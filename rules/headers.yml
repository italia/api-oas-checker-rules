rules:
  no-forbidden-headers:
    description: |-
      OAS do not allow using the following HTTP headers in a specification
      file: Authorization, Content-Type and Accept.
      You MUST use the associate functionalities provided by OAS, instead.
    message: "Do not define 'Authorization', 'Content-Type' or 'Accept' as headers; use the specific OAS fields for security schemes or media types instead."
    severity: error
    given:
      - "$..parameters[?(@ && @.in == 'header')].name"
      - $..[responses][*].headers.*~
    then:
      function: pattern
      functionOptions:
        notMatch: >-
          /^(accept|content-type|authorization)$/i

  no-x-headers-request: &no-x-headers
    description: |-
      'HTTP' headers SHOULD NOT start with 'X-' RFC6648.
    severity: warn
    given:
      - "$..parameters[?(@ && @.in == 'header')].name"
    message: "[RFC6648] Avoid using 'X-' prefix for header '{{value}}'. Use meaningful names instead."
    recommended: true
    type: style
    then:
      function: pattern
      functionOptions:
        # De Morgan:  !~ /^x-/ <=> h[0] != 'x' || h[1] != '-'
        match: >-
          /^([^x]|.[^-])|RateLimit-|Correlation-ID|ReplyTo/i
  no-x-headers-response:
    <<: *no-x-headers
    given:
      - $..[responses][*].headers.*~
    message: "[RFC6648] Avoid using 'X-' prefix for response headers. Use meaningful names instead."
    then:
      function: pattern
      functionOptions:
        match: >-
          /^([^x]|.[^-])|RateLimit-|Correlation-ID|ReplyTo/i
